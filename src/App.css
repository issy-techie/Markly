@tailwind base;
@tailwind components;
@tailwind utilities;

/* 基本的なリセットとアプリ全体のスタイル */
html, body, #root {
  height: 100%;
  margin: 0;
  overflow: hidden; /* スクロールは各ペインで行うため */
  background-color: #ffffff;
  color: #0f172a;
}

/* ダークモード対応用（後ほど実装） */
.dark body {
  background-color: #1e293b;
  color: #f8fafc;
}

/* プレビューエリア内のMarkdown装飾 */
.preview-area h1 { @apply text-3xl font-bold border-b pb-2 mb-4; }
.preview-area h2 { @apply text-2xl font-semibold border-b pb-1 mb-3 mt-6; }
.preview-area h3 { @apply text-xl font-semibold mb-2 mt-4; }
.preview-area p { @apply mb-4 leading-relaxed; }
.preview-area ul { @apply list-disc ml-6 mb-4; }
.preview-area ol { @apply list-decimal ml-6 mb-4; }
.preview-area blockquote { @apply border-l-4 border-slate-300 pl-4 italic text-slate-600; }
.preview-area code { @apply bg-slate-200 dark:bg-slate-700 text-slate-800 dark:text-slate-200 px-1 rounded text-sm font-mono; }
.preview-area pre { @apply bg-slate-800 text-slate-100 p-4 rounded-lg overflow-x-auto my-4; }
.preview-area pre code { @apply bg-transparent p-0 text-slate-100; }
.preview-area table { @apply w-full border-collapse mb-4 text-sm; }
.preview-area th { @apply border border-slate-300 dark:border-slate-600 px-4 py-2 bg-slate-100 dark:bg-slate-800 font-semibold text-left; }
.preview-area td { @apply border border-slate-300 dark:border-slate-600 px-4 py-2; }

/* 共通スクロールバースタイル (Editor, Preview, Sidebar) */
.custom-scrollbar::-webkit-scrollbar,
.cm-scroller::-webkit-scrollbar {
  width: 10px;
  height: 10px;
}

.custom-scrollbar::-webkit-scrollbar-track,
.cm-scroller::-webkit-scrollbar-track {
  background: transparent;
}

.custom-scrollbar::-webkit-scrollbar-thumb,
.cm-scroller::-webkit-scrollbar-thumb {
  background-color: #cbd5e1;
  border-radius: 5px;
  border: 2px solid transparent; 
  background-clip: content-box;
}

.custom-scrollbar::-webkit-scrollbar-thumb:hover,
.cm-scroller::-webkit-scrollbar-thumb:hover {
  background-color: #94a3b8;
}

.dark .custom-scrollbar::-webkit-scrollbar-thumb,
.dark .cm-scroller::-webkit-scrollbar-thumb {
  background-color: #475569;
}

.dark .custom-scrollbar::-webkit-scrollbar-thumb:hover,
.dark .cm-scroller::-webkit-scrollbar-thumb:hover {
  background-color: #64748b;
}

.custom-scrollbar::-webkit-scrollbar-corner,
.cm-scroller::-webkit-scrollbar-corner {
  background: transparent;
}

/* タブバー用スクロールバー (横のみ、細く) */
.tab-scrollbar {
  overflow-x: auto;
  overflow-y: hidden;
}

.tab-scrollbar::-webkit-scrollbar {
  height: 4px;
  width: 0px;
}

.tab-scrollbar::-webkit-scrollbar-track {
  background: transparent;
}

.tab-scrollbar::-webkit-scrollbar-thumb {
  background-color: #cbd5e1;
  border-radius: 2px;
}

.tab-scrollbar::-webkit-scrollbar-thumb:hover {
  background-color: #94a3b8;
}

.dark .tab-scrollbar::-webkit-scrollbar-thumb {
  background-color: #475569;
}

.dark .tab-scrollbar::-webkit-scrollbar-thumb:hover {
  background-color: #64748b;
}

/* タブ ドラッグ&ドロップ インジケータ */
@keyframes tab-drop-pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.5; }
}

.tab-drop-before {
  box-shadow: -3px 0 0 0 #3b82f6, -5px 0 8px -2px rgba(59, 130, 246, 0.4);
  animation: tab-drop-pulse 1s ease-in-out infinite;
}

.tab-drop-after {
  box-shadow: 3px 0 0 0 #3b82f6, 5px 0 8px -2px rgba(59, 130, 246, 0.4);
  animation: tab-drop-pulse 1s ease-in-out infinite;
}

/* ドラッグ中のタブ（ゴースト） */
.tab-drag-ghost {
  position: fixed;
  z-index: 9999;
  pointer-events: none;
  opacity: 0.85;
  transform: scale(1.02);
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2), 0 0 0 1px rgba(59, 130, 246, 0.3);
  border-radius: 0.5rem 0.5rem 0 0;
  transition: opacity 0.15s ease;
}

/* ドラッグ中の他タブのスライドアニメーション */
.tab-slide-transition {
  transition: transform 0.2s cubic-bezier(0.2, 0, 0, 1);
}

/* リサイズハンドル */
.resize-handle-v {
  width: 4px;
  cursor: col-resize;
  background: transparent;
  transition: background-color 0.15s ease;
  flex-shrink: 0;
}

.resize-handle-v:hover {
  background-color: rgba(59, 130, 246, 0.5); /* blue-500 with opacity */
}

.resize-handle-v:active {
  background-color: rgba(59, 130, 246, 0.8);
}

/* 縦リサイズハンドル（横向きの線） */
.resize-handle-h {
  height: 4px;
  cursor: row-resize;
  background: transparent;
  transition: background-color 0.15s ease;
  flex-shrink: 0;
}

.resize-handle-h:hover {
  background-color: rgba(59, 130, 246, 0.5);
}

.resize-handle-h:active {
  background-color: rgba(59, 130, 246, 0.8);
}

/* Toast notification slide-in animation */
@keyframes toast-slide-in {
  from {
    transform: translateX(100%);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}

.toast-slide-in {
  animation: toast-slide-in 0.3s ease-out;
}

/* CodeMirror Scroller Override */
.cm-scroller {
  overflow: auto !important;
}

/* 
 * エディタ入力時の折り畳み（フォールディング）マーク出現・消失による、
 * レイアウトシフト（画面ブレ）を防ぐためにガター幅を固定
 */
.cm-foldGutter {
  width: 16px !important;
}

/* Zenモード（集中モード）ヒント表示 */
@keyframes zen-hint-fade {
  0% { opacity: 0; transform: translate(-50%, 10px); }
  15% { opacity: 1; transform: translate(-50%, 0); }
  85% { opacity: 1; transform: translate(-50%, 0); }
  100% { opacity: 0; transform: translate(-50%, -10px); }
}

.zen-mode-hint {
  position: fixed;
  bottom: 32px;
  left: 50%;
  transform: translateX(-50%);
  padding: 8px 20px;
  border-radius: 8px;
  background: rgba(0, 0, 0, 0.7);
  color: #e2e8f0;
  font-size: 13px;
  z-index: 9999;
  pointer-events: auto;
  cursor: pointer;
  animation: zen-hint-fade 3s ease-in-out forwards;
  white-space: nowrap;
  user-select: none;
  backdrop-filter: blur(4px);
}

/* Wiki Link ハイライト (CodeMirror エディタ内) */
.cm-wiki-link {
  color: #059669;
  text-decoration: underline;
  text-decoration-style: dotted;
  border-radius: 2px;
  padding: 0 1px;
}

.dark .cm-wiki-link {
  color: #34d399;
}

/* スニペット補完ポップアップ */
.cm-tooltip-autocomplete {
  border: 1px solid #e2e8f0 !important;
  border-radius: 8px !important;
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.10) !important;
  overflow: hidden;
}

.dark .cm-tooltip-autocomplete {
  border-color: #334155 !important;
  background: #1e293b !important;
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3) !important;
}

.cm-tooltip-autocomplete > ul {
  font-family: inherit !important;
  font-size: 13px !important;
}

.cm-tooltip-autocomplete > ul > li {
  padding: 4px 8px !important;
}

.cm-tooltip-autocomplete > ul > li[aria-selected] {
  background: #3b82f6 !important;
  color: white !important;
}

.cm-completionIcon-snippet::after {
  content: "{ }";
  font-size: 10px;
  font-family: monospace;
  opacity: 0.7;
}

/* テーブル編集ツールバー */
.table-toolbar {
  position: fixed;
  z-index: 100;
  display: flex;
  align-items: center;
  gap: 1px;
  padding: 3px 4px;
  border-radius: 8px;
  background: #ffffff;
  border: 1px solid #e2e8f0;
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.10), 0 1px 4px rgba(0, 0, 0, 0.06);
  white-space: nowrap;
  user-select: none;
  pointer-events: auto;
}

.dark .table-toolbar {
  background: #1e293b;
  border-color: #334155;
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3), 0 1px 4px rgba(0, 0, 0, 0.2);
}

/* ─── PDF エクスポート用 印刷スタイル ─── */
@media print {
  /* レイアウトの制約を解除 */
  html, body, #root {
    height: auto !important;
    overflow: visible !important;
    background: white !important;
    color: #1f2328 !important;
  }

  /* UI要素をすべて非表示 */
  aside,
  [data-tab-bar],
  [data-editor-pane],
  [data-status-bar],
  [data-outline-panel],
  [data-reference-panel],
  .resize-handle-v,
  .resize-handle-h,
  .table-toolbar,
  .zen-mode-hint {
    display: none !important;
  }

  /* メインエリアをブロック表示に変更（flexを解除） */
  #main-editor-area {
    display: block !important;
    overflow: visible !important;
    height: auto !important;
  }

  /* ルートフレックスコンテナの制約を解除 */
  #root > div {
    display: block !important;
    height: auto !important;
    overflow: visible !important;
  }

  /* メインカラムの制約を解除 */
  #main-editor-area + div,
  #main-editor-area ~ div {
    display: block !important;
  }

  /* プレビューペインのラッパー（flex-1 relative overflow-hidden flex） */
  .preview-area {
    width: 100% !important;
    max-width: 800px !important;
    margin: 0 auto !important;
    height: auto !important;
    overflow: visible !important;
    padding: 0 !important;
    font-size: 14px !important;
    /* ダークモードの prose-invert を打ち消し、印刷用に黒文字化 */
    color: #1f2328 !important;
    background: white !important;
    --tw-prose-body: #1f2328 !important;
    --tw-prose-headings: #1f2328 !important;
    --tw-prose-links: #0969da !important;
    --tw-prose-bold: #1f2328 !important;
    --tw-prose-counters: #57606a !important;
    --tw-prose-bullets: #57606a !important;
    --tw-prose-quotes: #57606a !important;
    --tw-prose-code: #1f2328 !important;
    --tw-prose-hr: #d1d9e0 !important;
    --tw-prose-th-borders: #d1d9e0 !important;
    --tw-prose-td-borders: #d1d9e0 !important;
  }

  /* prose-invert の子要素も含め文字色を強制上書き */
  .preview-area *:not(code):not(pre):not(a) {
    color: inherit !important;
  }
  .preview-area a {
    color: #0969da !important;
  }

  /* プレビューペインの親要素 */
  .preview-area-wrapper,
  .preview-area + div {
    overflow: visible !important;
  }

  /* プレビュー内の画像 */
  .preview-area img {
    max-width: 100% !important;
    page-break-inside: avoid;
  }

  /* プレビュー内のコードブロック */
  .preview-area pre {
    white-space: pre-wrap !important;
    word-wrap: break-word !important;
    page-break-inside: avoid;
    background-color: #f6f8fa !important;
    color: #1f2328 !important;
  }
  .preview-area pre code {
    color: #1f2328 !important;
    background-color: transparent !important;
  }
  .preview-area code {
    background-color: #eff1f3 !important;
    color: #1f2328 !important;
  }

  /* テーブルの印刷スタイル */
  .preview-area table {
    page-break-inside: avoid;
  }
  .preview-area th {
    background-color: #f6f8fa !important;
    border-color: #d1d9e0 !important;
    color: #1f2328 !important;
  }
  .preview-area td {
    border-color: #d1d9e0 !important;
    color: #1f2328 !important;
  }

  /* blockquote */
  .preview-area blockquote {
    color: #636c76 !important;
    border-left-color: #d1d9e0 !important;
  }

  /* 見出しの改ページ制御 */
  .preview-area h1,
  .preview-area h2,
  .preview-area h3,
  .preview-area h4 {
    page-break-after: avoid;
    color: #1f2328 !important;
  }
  .preview-area h1,
  .preview-area h2 {
    border-color: #d1d9e0 !important;
  }
}
